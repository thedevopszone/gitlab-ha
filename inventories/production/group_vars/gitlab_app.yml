---
# GitLab Application Layer — group variables
# All app nodes share identical configuration and secrets.

# ============================================================
# GitLab Omnibus
# ============================================================
gitlab_omnibus_package: gitlab-ce
gitlab_external_url: "http://gitlab.example.local"

# ============================================================
# PostgreSQL (external — managed by Patroni)
# ============================================================
# In production, replace with a VIP or PgBouncer address.
# Default discovers the first postgres_cluster host dynamically.
gitlab_db_host: "{{ hostvars[groups['postgres_cluster'][0]]['ansible_host'] }}"
gitlab_db_port: 5432
gitlab_db_name: gitlabhq_production
gitlab_db_username: gitlab
gitlab_db_password: "changeme-gitlab-db"    # Override via Ansible Vault

# ============================================================
# Redis Sentinel (external)
# ============================================================
redis_sentinel_port: 26379
redis_sentinel_master_name: mymaster

# ============================================================
# Praefect / Gitaly (external)
# ============================================================
# In production, replace praefect_external_address with a TCP
# load-balancer VIP in front of the Praefect cluster.
# Default points to the first praefect_cluster node.
praefect_port: 2305
praefect_virtual_storage_name: default
praefect_auth_token: "changeme-praefect-secret"   # Must match praefect cluster

# ============================================================
# Puma (Rails application server)
# ============================================================
puma_worker_processes: 4
puma_min_threads: 4
puma_max_threads: 4

# ============================================================
# Sidekiq
# ============================================================
sidekiq_concurrency: 20

# ============================================================
# Workhorse (GitLab HTTP frontend — external LB proxies here)
# ============================================================
gitlab_workhorse_listen_addr: "0.0.0.0"
gitlab_workhorse_port: 8181

# ============================================================
# Patroni REST API (used to discover primary for DB setup)
# ============================================================
patroni_rest_api_port: 8008
